<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Our thing</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="./jquery.min.js"></script>

  <link rel="stylesheet" type="text/css" href="./normalize.css">
  <link rel="stylesheet" type="text/css" href="./result-light.css">

  <script type="text/javascript" src="./fabric.js"></script>


  <script type="text/javascript">

  var colours = ["#bf4040", "#ff8205", "#FFFF00", "#33cc33", "#40bfbf",
               "#3333cc", "#9f40bf", "#bf8040", "#878788", "#000000"];

  $(document).ready (function () {
      for(var i=0, size=colours.length; i < size; i++) {
          var colour = colours[i];
          console.log(colour)
          $("#colorpicker").append("<button style='background-color:"+colours[i]+"'; value="+colours[i]+"></button>");
      }
  });  

  $(window).load(function() {
      
    var canvas;
    var bg_img = document.getElementById('image');
    // console.log(img_height)

    $(function () {
        canvas = window._canvas = new fabric.Canvas('draw-canvas');
        canvas.backgroundColor = null;
        canvas.setHeight(bg_img.height);
        canvas.setWidth(bg_img.width);
        canvas.calcOffset();
        canvas.isDrawingMode= 1;
        canvas.freeDrawingBrush.color = "red";
        canvas.freeDrawingBrush.width = 10;
        canvas.renderAll();

        document.getElementById('colorpicker').addEventListener('click', function (e) {
            console.log(e.target.value);
            canvas.freeDrawingBrush.color = e.target.value;
        });
      });

    document.getElementById("clear").addEventListener('click', function() {
      canvas.clear();
      console.log("cleared");
    });

    document.getElementById("drawing-line-width").onchange = function() {
      canvas.freeDrawingBrush.width = parseInt(this.value, 10) || 1;
      document.getElementById("drawing-line-width-span").innerHTML = this.value;
    }

    document.getElementById("drawing-mode").onclick = function() {
      canvas.isDrawingMode = !canvas.isDrawingMode;
      if (canvas.isDrawingMode) {
        document.getElementById("drawing-mode").innerHTML = 'Cancel drawing mode';
        document.getElementById('drawing-options').style.display = '';
      }
      else {
        document.getElementById("drawing-mode").innerHTML = 'Enter drawing mode';
        document.getElementById('drawing-options').style.display = 'none';
      }
    };

    document.getElementById("export-svg-button").onclick = function() {
      var trsvg = canvas.toSVG();
      console.log('save...');
      console.log(JSON.stringify(trsvg));
      // var canvas_svg = new fabric.Canvas('canvas-svg');
      // ('#svg-tag').html(trsvg);
    };

  });

</script>
</head>
<body>


<div class="container" style="position: relative; display: inline-block;">
  <img id="image" src="https://s3-eu-west-1.amazonaws.com/informatics-webimages/test-plot.png" width="400" style="position: absolute"/>
  <canvas id="draw-canvas" style="position: relative; left: 0; top: 0; z-index: 1;"></canvas>
</div>

<div id="drawing" style="vertical-align: top; display: inline-block; margin-left: 20px;">
  
  <div id="drawing-export-svg">
    <button id="export-svg-button">Export SVG</button>
  </div>

  <div id="drawing-toggle"> 
    <button id="drawing-mode" class="btn btn-info">Cancel drawing mode</button> 
  </div>

  <div id="drawing-options"> 
    <div id="colorpicker">
    <!-- Filled with JavaScript
    -->
    </div>
    <button id="clear">clear</button>
    <label for="drawing-line-width">Line width:</label>
    <span class="info" id="drawing-line-width-span">30</span>
    <input type="range" value="30" min="0" max="150" id="drawing-line-width">
  </div>
</div>


  
  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "qhfvpj4z"
      }], "*")
    }
  </script>


</body></html>